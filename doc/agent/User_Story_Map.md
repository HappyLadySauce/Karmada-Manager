# 用户故事地图 (User Story Map) - Karmada-Manager 增强

## 1. 用户故事地图概述

本用户故事地图旨在从用户视角出发，梳理 Karmada-Manager 增强功能的核心用户活动、用户任务和具体的用户故事。它将帮助团队更好地理解用户需求，并为版本规划和功能优先级排序提供依据。本地图与 PRD 中的用户场景和 Roadmap 中的版本规划紧密关联。

**核心用户角色**: 

-   **平台运维工程师 (张伟)**: 主要负责多集群环境的搭建、维护、监控和故障排查。
-   **应用开发者 (李娜)**: 主要关注应用的部署、运行状态和问题定位。

## 2. 用户活动流 (横向 - Backbone / High-Level Activities)

| 用户活动 (Activities)           | 目标用户画像         |
| ------------------------------- | -------------------- |
| **1. 监控集群与资源健康状态**     | 张伟 (主要), 李娜     |
| **2. 管理成员集群内部资源**       | 张伟 (主要)          |
| **3. 配置与验证资源调度策略**     | 张伟 (主要)          |
| **4. 追踪应用部署与调度路径**     | 张伟 (主要), 李娜     |
| **5. 故障诊断与问题定位**         | 张伟 (主要), 李娜     |

## 3. 用户任务分解与故事 (纵向 - Narratives / User Tasks & Stories)

### 用户活动 1: 监控集群与资源健康状态

| 用户任务 (User Tasks)                             | 用户故事 (User Stories) - 作为 [用户类型], 我想要 [完成某事], 以便 [获得价值]                                                                                                | 优先级 (MVP) | 优先级 (v1.1) | 优先级 (v1.2) | PRD 功能点参考         |
| :------------------------------------------------ | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :----------- | :------------ | :------------ | :--------------------- |
| **1.1 查看 Karmada 控制面概览**                     | 作为平台运维工程师，我想要快速了解 Karmada 控制面核心组件 (API Server, Scheduler, Controllers) 的健康状态，以便确认 Karmada 系统本身运行正常。                                        | P1           |               |               | 5.3                    |
| **1.2 查看所有成员集群的整体状态**                  | 作为平台运维工程师，我想要在一个统一的视图中看到所有已纳管成员集群的列表，包含其名称、连接状态、K8s 版本、节点总数/Ready数、总体资源 (CPU/Mem/Pod) 使用概览，以便快速评估整体多集群健康度和容量。 | P0           |               |               | 5.2.1 (集群列表)       |
| **1.3 深入查看特定成员集群的健康与资源**            | 作为平台运维工程师，我想要点击任一成员集群，进入其详情页，查看更详细的资源分配 (Allocatable/Requests/Limits)、节点健康汇总、关键事件等信息，以便深入分析特定集群状况。                | P0           |               |               | 5.2.1 (集群详情)       |
| **1.4 查看特定成员集群的节点列表与状态**            | 作为平台运维工程师，我想要在成员集群详情中看到该集群所有节点的列表，包含节点名称、状态、角色、IP 地址、资源分配情况 (CPU/Mem/Pod)，以便监控节点健康和资源分布。                              | P0           |               |               | 5.2.1 (节点列表)       |
| **1.5 查看特定节点的详细信息**                      | 作为平台运维工程师，我想要点击特定节点，查看其详细描述 (Conditions, Taints, Capacity, Allocatable, System Info)，以便诊断节点问题或了解节点配置。                                    | P0           |               |               | 5.2.1 (节点详情)       |
| **1.6 查看特定节点上运行的 Pod 列表**               | 作为平台运维工程师，我想要在节点详情中看到该节点上当前运行的所有 Pod 列表（名称、命名空间、状态），以便了解节点负载和排查 Pod 相关问题。                                                        | P0           |               |               | 5.2.1 (节点上的 Pods)  |

### 用户活动 2: 管理成员集群内部资源

| 用户任务 (User Tasks)                             | 用户故事 (User Stories)                                                                                                                                                    | 优先级 (MVP) | 优先级 (v1.1) | 优先级 (v1.2) | PRD 功能点参考             |
| :------------------------------------------------ | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :----------- | :------------ | :------------ | :------------------------- |
| **2.1 查看成员集群中的特定资源 (如 Deployment, Pod)** | 作为平台运维工程师，我想要在 Karmada-Manager 中选择一个成员集群，然后浏览并查看该集群内部署的特定 Kubernetes 资源 (如 Deployments, Pods, ConfigMaps) 的 YAML 定义和状态，以便进行检查和审计。 |              | P0            |               | 5.2.1 (成员集群资源查看) |
| **2.2 修改成员集群中的配置类资源 (如 ConfigMap)**   | 作为平台运维工程师，我想要在 Karmada-Manager 中直接编辑某个成员集群中的 ConfigMap 或 Secret 的 YAML 内容，并应用更改，以便快速进行小的配置调整而无需切换工具。                                 |              | P1            |               | 5.2.1 (成员资源编辑)     |
| **2.3 查看成员集群中 Pod 的日志**                   | 作为平台运维工程师或应用开发者，我想要在 Karmada-Manager 中直接查看运行在某个成员集群特定 Pod 的实时日志（支持选择容器、查看历史日志），以便进行故障排查。                                       |              | P0            |               | 5.2.1 (Pod 日志)         |
| **2.4 (可选) 进入成员集群中 Pod 的终端**            | 作为平台运维工程师，我想要在极端情况下，能够通过 Karmada-Manager 安全地进入运行在某个成员集群特定 Pod 的终端，以便执行一些临时的调试命令。                                                      |              |               | P2            | 5.2.1 (Pod 终端)         |

### 用户活动 3: 配置与验证资源调度策略

| 用户任务 (User Tasks)                             | 用户故事 (User Stories)                                                                                                                                                              | 优先级 (MVP) | 优先级 (v1.1) | 优先级 (v1.2) | PRD 功能点参考                 |
| :------------------------------------------------ | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :----------- | :------------ | :------------ | :----------------------------- |
| **3.1 创建/编辑 PropagationPolicy**               | 作为平台运维工程师，我想要在 Karmada-Manager 中通过一个友好的界面创建或编辑 PropagationPolicy，指定资源选择器、目标集群（通过标签、名称等）、副本分配策略（固定、按权重等），以便定义应用的部署范围和方式。 |              |               | P1            | 5.2.2 (策略管理)             |
| **3.2 创建/编辑 OverridePolicy**                  | 作为平台运维工程师，我想要在 Karmada-Manager 中创建或编辑 OverridePolicy，针对特定集群覆盖 Workload 中的某些字段（如镜像、资源请求/限制），以便实现差异化配置。                                         |              |               | P1            | 5.2.2 (策略管理)             |
| **3.3 查看调度策略如何影响 Workload**             | 作为平台运维工程师，当我查看一个 Workload (如 Deployment) 时，我想要清晰地看到它关联了哪些 PropagationPolicy 和 OverridePolicy，以及这些策略的关键规则摘要，以便理解其调度逻辑。                       | P0           |               |               | 5.2.2 (Propagation 可视化) |
| **3.4 可视化验证副本如何在集群间分配**            | 作为平台运维工程师，对于一个使用 PropagationPolicy 分配副本的 Deployment，我想要在 Karmada-Manager 中看到一个可视化图表或列表，清晰展示计划向哪些集群分配多少副本，以及每个集群当前实际 Ready 的副本数，以便验证调度策略是否按预期工作。 | P0           |               |               | 5.2.2 (Propagation 可视化) |

### 用户活动 4: 追踪应用部署与调度路径

| 用户任务 (User Tasks)                             | 用户故事 (User Stories)                                                                                                                                                             | 优先级 (MVP) | 优先级 (v1.1) | 优先级 (v1.2) | PRD 功能点参考             |
| :------------------------------------------------ | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :----------- | :------------ | :------------ | :------------------------- |
| **4.1 查看 Pod 的基本部署信息**                     | 作为用户（运维或开发者），当我查看一个 Pod 时，我想要知道它部署在哪个成员集群的哪个节点上，它的 IP 地址、状态、重启次数等基本信息，以便快速了解其运行上下文。                                             | P0           |               |               | 5.2.2 (Pod 调度路径)     |
| **4.2 追溯 Pod 所属的 Workload 和调度策略**         | 作为用户，当我查看一个 Pod 时，我想要知道它是由哪个 Workload (如 Deployment) 创建的，以及这个 Workload 应用了哪个 PropagationPolicy (或 OverridePolicy) 将其调度到当前位置，以便理解其来源和调度决策。 |              | P0            |               | 5.2.2 (Pod 调度路径)     |
| **4.3 理解 Pod 被调度到特定集群/节点的原因**      | 作为用户，我想要看到一个简明的说明，解释为什么特定的 Pod 被调度到了当前的成员集群和节点（例如，基于集群标签匹配、满足污点容忍、符合资源需求、或调度器权重等），以便深入理解调度细节。                          |              | P0            |               | 5.2.2 (Pod 调度路径)     |

### 用户活动 5: 故障诊断与问题定位

| 用户任务 (User Tasks)                             | 用户故事 (User Stories)                                                                                                                                                            | 优先级 (MVP) | 优先级 (v1.1) | 优先级 (v1.2) | PRD 功能点参考                             |
| :------------------------------------------------ | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :----------- | :------------ | :------------ | :----------------------------------------- |
| **5.1 通过事件排查 Karmada层面问题**              | 作为平台运维工程师，当 Karmada 调度或同步出现问题时，我想要在一个集中的地方查看 Karmada 控制面相关的事件，以便快速定位问题根源（如策略冲突、API连接失败等）。                                          |              |               | P1            | 5.3 (统一事件查看)                       |
| **5.2 通过事件排查成员集群Pod问题**               | 作为用户，当一个 Pod 启动失败或运行异常时，我想要方便地查看该 Pod 相关的 Kubernetes 事件，以便了解失败原因（如镜像拉取失败、资源不足、健康检查失败）。                                                       | P0           |               |               | 5.2.1 (Pod Events in member cluster context) |
| **5.3 通过日志排查 Pod 应用级问题**               | 作为用户，当应用表现不符合预期时，我想要快速查看相关 Pod 的应用日志，搜索关键词，以便诊断应用内部的错误。                                                                                              |              | P0            |               | 5.2.1 (Pod 日志)                         |
| **5.4 结合节点状态排查 Pod 调度失败问题**         | 作为平台运维工程师，当 Pod 长时间处于 Pending 状态时，我想要结合目标集群的节点状态（如资源不足、存在不兼容的污点）和调度策略来分析原因，以便解决调度问题。                                                 | P0           |               |               | 5.2.1 (节点详情), 5.2.2 (调度可视化) |
| **5.5 通过全局搜索快速定位问题资源**              | 作为用户，当我只记得资源的部分名称或标签时，我想要通过全局搜索快速找到相关的 Workload、Pod、Policy 或集群，以便迅速开始问题排查。                                                                      |              | P1            |               | 5.3 (全局资源搜索)                       |

## 4. 故事优先级与版本映射 (关联 Roadmap 版本)

*(优先级已在上述表格中标注，对应 Roadmap 中的 MVP, v1.1, v1.2 版本规划)*

-   **MVP 版本核心故事**: 集中在活动1和活动3、4的基础部分，确保用户能看到集群/节点状态，并初步理解调度结果。
    -   [1.2] 查看所有成员集群的整体状态
    -   [1.3] 深入查看特定成员集群的健康与资源
    -   [1.4] 查看特定成员集群的节点列表与状态
    -   [1.5] 查看特定节点的详细信息
    -   [1.6] 查看特定节点上运行的 Pod 列表
    -   [3.3] 查看调度策略如何影响 Workload
    -   [3.4] 可视化验证副本如何在集群间分配
    -   [4.1] 查看 Pod 的基本部署信息
    -   [5.2] 通过事件排查成员集群Pod问题

-   **v1.1 版本核心故事**: 增强可操作性和追溯深度，提升排障效率。
    -   [2.1] 查看成员集群中的特定资源 (如 Deployment, Pod)
    -   [2.3] 查看成员集群中 Pod 的日志
    -   [4.2] 追溯 Pod 所属的 Workload 和调度策略
    -   [4.3] 理解 Pod 被调度到特定集群/节点的原因
    -   [5.5] 通过全局搜索快速定位问题资源

-   **v1.2 版本核心故事**: 完善辅助功能，提升整体易用性和管理能力。
    -   [2.2] 修改成员集群中的配置类资源 (如 ConfigMap)
    -   [3.1] 创建/编辑 PropagationPolicy
    -   [3.2] 创建/编辑 OverridePolicy
    -   [5.1] 通过事件排查 Karmada层面问题

*注：此地图为初始版本，会根据项目进展和用户反馈持续迭代。* 